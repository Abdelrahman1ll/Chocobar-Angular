<app-toast-message
  *ngIf="showToast"
  [message]="toastMessage"
  [type]="toastType"
  [duration]="3000"
  (closed)="showToast = false"
/>

<app-header></app-header>

<app-back></app-back>

<!-- نموذج إضافة منتج جديد للوحة تحكم الأدمن -->
<form
  [formGroup]="form"
  (ngSubmit)="onSubmit()"
  dir="rtl"
  class="bg-[#f3dfc4] text-[#372113] rounded-2xl shadow-lg p-6 space-y-6 w-full max-w-3xl mx-auto my-10 font-sans"
>
  <h2 class="text-3xl font-extrabold mb-4 text-center">إضافة منتج جديد</h2>

  <!-- اسم المنتج -->
  <div>
    <label class="block text-base mb-1 text-[#5a3925]">اسم المنتج</label>
    <input
      formControlName="title"
      type="text"
      [ngClass]="{
        'border-red-500':
          form.get('title')?.invalid && form.get('title')?.touched,
        'border-[#3b2415]':
          form.get('title')?.valid || !form.get('title')?.touched
      }"
      class="w-full p-2 border rounded focus:outline-none focus:ring-2 placeholder:text-[#8c6d50] text-[#372113] bg-[#f7e5c9]"
      placeholder="مثال: وافل بالشوكولاتة"
    />

    <!-- رسالة الخطأ -->
    <div
      *ngIf="form.get('title')?.invalid && form.get('title')?.touched"
      class="text-red-600 text-sm mt-1"
    >
      اسم المنتج مطلوب
    </div>
  </div>

  <!-- سعر المنتج -->
  <div>
    <label class="block mb-1 text-base text-[#5a3925]">السعر</label>
    <input
      formControlName="price"
      type="number"
      [ngClass]="{
        'border-red-500':
          form.get('price')?.invalid && form.get('price')?.touched,
        'border-[#3b2415]':
          form.get('price')?.valid || !form.get('price')?.touched
      }"
      class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-[#a15d36] placeholder:text-[#8c6d50] text-[#372113] bg-[#f7e5c9]"
      placeholder="مثال: 70"
    />

    <!-- رسالة الخطاء -->
    <div
      *ngIf="form.get('price')?.invalid && form.get('price')?.touched"
      class="text-red-600 text-sm mt-1"
    >
      سعر المنتج مطلوب
    </div>
  </div>

  <!-- صورة المنتج -->
  <div>
    <label class="block mb-1 text-base text-[#5a3925]">صورة المنتج</label>
    <input
      #fileInput
      (change)="onFileSelected($event)"
      type="file"
      class="w-full p-2 border border-[#a15d36] rounded cursor-pointer bg-[#f7e5c9] text-[#372113]"
    />

    <!-- رسالة الخطاء -->
    <div
      *ngIf="form.get('image')?.invalid && form.get('image')?.touched"
      class="text-red-600 text-sm mt-1"
    >
      صورة المنتج مطلوبة
    </div>
  </div>

  <!-- سويتشات إعدادات الشوكولاتة -->
  <div
    class="grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-xl w-full mx-auto mb-6"
  >
    <!-- سويتش نوعين شوكولاتة -->
    <div
      class="flex items-center justify-between bg-[#fbe8d0] p-2 rounded-xl shadow-md"
    >
      <span class="text-[#372113] font-semibold text-sm sm:text-base">
        يسمح باختيار نوعين شوكولاتة
      </span>
      <label class="relative inline-block w-12 h-6 cursor-pointer">
        <input
          type="checkbox"
          formControlName="TwoKindsOfChocolate"
          class="sr-only peer"
        />
        <div
          class="w-full h-full bg-gray-500 rounded-full peer-checked:bg-[#5a3925] transition-colors duration-300"
        ></div>
        <div
          class="absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform duration-300 peer-checked:translate-x-6"
        ></div>
      </label>
    </div>

    <!-- سويتش أربع أنواع شوكولاتة -->
    <div
      class="flex items-center justify-between bg-[#fbe8d0] p-2 rounded-xl shadow-md"
    >
      <span class="text-[#372113] font-semibold text-sm sm:text-base">
        يسمح باختيار أربع أنواع شوكولاتة
      </span>
      <label class="relative inline-block w-12 h-6 cursor-pointer">
        <input
          type="checkbox"
          formControlName="FourTypesOfChocolate"
          class="sr-only peer"
        />
        <div
          class="w-full h-full bg-gray-500 rounded-full peer-checked:bg-[#5a3925] transition-colors duration-300"
        ></div>
        <div
          class="absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform duration-300 peer-checked:translate-x-6"
        ></div>
      </label>
    </div>
  </div>

  <app-chocolates
    (selectedChocolate)="handleSelectedChocolates($event)"
    [resetTrigger]="resetChocolates"
  ></app-chocolates>

  <app-add-ons
    (selectedAddOn)="handleSelectedAddOns($event)"
    [resetTrigger]="resetAddOns"
  ></app-add-ons>

  <!-- زر الحفظ -->
  <div class="text-center pt-4">
    <button
      type="submit"
      class="bg-[#a15d36] text-white w-full h-10 rounded-full hover:opacity-90 transition"
    >
      <ng-container *ngIf="!isLoding">حفظ المنتج</ng-container>
      <ng-container *ngIf="isLoding">
        <span
          class="inline-block h-5 w-5 border-2 border-[#f3dfc4] border-t-transparent rounded-full animate-spin"
        ></span>
      </ng-container>
    </button>
  </div>
</form>

<app-footer></app-footer>
